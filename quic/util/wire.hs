{-# LANGUAGE OverloadedStrings #-}

module Main where

import Data.ByteString (ByteString)
import Network.TLS
import System.Environment

import Network.QUIC

main :: IO ()
main = do
    [key, cert] <- getArgs
    server key cert
    client

server :: FilePath -> FilePath -> IO ()
server key cert = do
    ctx <- serverContext Draft20 key cert (CID "\x41\x6c\x50\xc4\x3e\x23\x48\x7c")
    (InitialPacket _ver _dcid _scid _pn _token frames, _) <- decodePacket ctx clientInitial
    let f (Crypto _ _) = True
        f _            = False
    let Crypto _off bs:_ = filter f frames
    let Right ch = decodeHandshakes13 bs
    print ch

client :: IO ()
client = do
    ctx <- clientContext Draft20 "www.mew.org" (CID "\x41\x6c\x50\xc4\x3e\x23\x48\x7c")
    (InitialPacket _ver _dcid _scid _pn _token frames, _) <- decodePacket ctx serverInitial
    let Crypto _off bs:_ = frames
    let Right sh = decodeHandshakes13 bs
    print sh

clientInitial :: ByteString
clientInitial = dec16 "c5ff00001150416c50c43e23487c0044ef09a187c81c038fec79039170d6c68ecaff275f40b30198ff5a5ad2b8405591e4fe6fb9997af32aeed7d8900ed68449564c87797398ff95bc1bc74d161e63ef8268625ac2b58adfd1d4f6d7184a327016dd4acbe740932e422a155f838de426d41468feca4810ef8954656efb654c9f90bac273770dc6bec46bc282e24e19e39074c9b0cad23ef8220562b661461be0519cfc67f92360e54b80d91d4e06a28f9237eeb9a11ab9d19f682479d6f0ebda68b955ad12870e248b4f81cd39b87f081e7497b00b02bf6b7413ff98ed0070a4971533e8c78396758c1538b1001a67fba36fe9ad97ba0015d813e524889270f923cee55aff34dc781f688aa4c79f6711cac3612796640428bb127aa68ff3a3c00ea35a48071045b7000203e6779b6b757324db677596e1ffd45d07d370d8786e5352c95ce400e9b7804d67a2347cfc68b4daea53cc2d8c08cbe8a0f4409bb92db8341fbc6c651fdaca3013f60fdb08a1652b742c6e23eff801cc19a4829f2863c3c371b7577e033a546dc7b34eb42593c51fb715b4acddc965ad51d8f6c61d0dc521a9ed4c35f8191af49c76191c53fc4acfb9e395354f901081d840ce4fd7e86cb10280a5c25aea70bae66a2860766751f6863d75025768bbad67f6b815dc8fbe7df008c68057196c19b279dd1e14ebd238c874370edff12d1d17a21b1072a138b113632c8aff8531864ca1269d3edff4704269488be437a0095c30890855ab8081e83c5c55b6ad0f2dab301ad32935940cd8db27c8e10450c9961f6b653a79fdbb0ea4b2d4afc0627a40168f9cd74427904ceac07ca2de664f0e2766891b27b272a0526fdc5499b23b8c5ebcf4166171888c023a63071687dfe96c04ec68babb5a6a61ee112803b345cdde7af9bd07ab8e6ab510f7c108d18bcaca88b3aec48add9c515d283a748cae9d6d526a8ac86dabb1b332cffb920fea0c7339fbd63aa5a8fd4e077c0d49baf4c8baec8eefc42c283b0a530115e6121de0a45982d91121755d20d5562819efb17dbcda1bf246b7d982abfe30e5f45d41c06162ff9a46b21a3271f3388352148f3ad86097c1555026f6f3e9bbe99f62a6dc619ce728d7e01c7efd96bda6102b08be73ec0561c729591ef59cb92fc86a0cc8d15527c676e64f97cae238d85ed1c33842bbe2efb028c8d9d5d49d9daa548a0cd3a46c79305fbae4edb26d0e8a41f903be21004107b22fd5abbc1ad07e22c965fc8af781570901ae793cf7b91d13c1b22ddc6b1bff5a1b84f7caee875937e0845193025d9efe9d02207ec58e7b2b41ac6052d326f99feaf43083c00b15654c327f62ad6c191275775df879ba5c483d846783957ac4d7c270ea03892c96be89f8af89552ad2e6b962d90c35e5f36283bca146b74fcace0738310b059df2746911bcc561ef1d387ead0dd5773a6485f444f3eead92f71047416ad7e20be1a102c8726139d1b4b3f800e50f42e30ad4d2bdfc173ee9d0a7f222794dfe06a333e5c80c9b62d6d5d542a7b3632719daab517c0a4676830adc2eeec6865edf53340f5934e0420fced033c31f3e171f5cae4d6e74ca53635315da6cc1919e196ad10fbab8403d720170dc60782cf09eedfd855dc417ecc8d6e8ef1fe43b47c13ef70cccb7f53c00c59ded1f8391fdf040a819430cde584d7609a640443a94d344ba20d533b632be1f36afdbe2ad880b76cffa024465e47a0d2497f2ea4f9472655a69c31c92b906bf769d36eb236c0c978a39d127a771844f0ec4d9dea898e595296f6dc37e44a3e6"

serverInitial :: ByteString
serverInitial = dec16 "ccff0000110f14c8ab6b77a0be9e0ad7c45f654b3a36e1a60040b5c94f930b811401122c60b31ce2133eb6f283ecaff9f17e6e43967b5f7bdcf68e2c8684e0dde553edf7f5a5cee5448f49e7282df211037d7ced68f57d553920a7a25394b06ca2334bc557e86c1a5fbaf1756019d8a2647dd87714a51de696f104574a65074afbcc003ea03a43698c0c7228daabf4f1b57b652bd0024606060dd5cf1163b782eec86bb552a4b1ffb9630f1f1bdf9b9acafc21e9f3aa5b21b4e6b7bd28775fe270dba5cd22070799cd0506e0d85ccf26e0ff0000110f14c8ab6b77a0be9e0ad7c45f654b3a36e1a643fad718a3d5e30a40c36485773a07cfcb101cf4d2957181eb9338c71aa0590c37d5e9a510377d409d1b2fc16e3c84614d296d533cea571a1c4972cd733fa3c3de89ac10d43a9118f242c21d641cac8abbea04b52126e6c4d40aa9886d3c846bceba6b98f645286fa3bd4c22b9a4686a18cd1dbdaf8a5197ad0c4e54f64c55c43c1aacc291c450b818934983af79cf39939a93f6d674dd3ac671fb57a67c3a636c6be9f1a8d1bcf617bd1b2261ef43ca3cce52c85d2985e8e043f1a0a52be1b49f54cfb178e9ab97181aabab5bd69f7168ce61bbd8a1308a4b52bf9e1be05858b2ae4dd1281a26568b65574ae740cc33ef0772aa1e41ffe3022b967507658e168c9107ba3303c9a412d3bebb0ddc82ba05089916a2701e1b061306afac9799418c379be5e8b49b51f15419ad1d5e0efcc98c492e7d4e36e6cb6161b39b2b3ec51829e3c406d3e110694bee948b52bbfe6e67ba77cbd393e10e779f48447191603a25eb76a42bce81ea0c53db0b200e1a03ccfa0d8143ea0084bf0ab17aaf39d4ea830ea64de3b4f6dfcf47e8d8233b1c9f6ad00cfbc34ca398dadb7639367d414889f69b4e58220e82c9e2e2107299de5a64a01b71c0606dfc9db96e354fe03e3ca003471186689daec83ef9f21ce89ab735aa540f8f2afb8a334bef5b3c42374cd4e9458685d4664de6e7e38c6a1794e17b6e1948e51e5baea82a009478d6188c341db32ecd16114ec5e5de2fdc65f5711d52f9c97a65e6d35ab02f359e361f582c31cee01ddf916369db5305c44079ececf1f26d668c0880e44429a9b57fd87f6e287878e5df81bf051643b400ca721004a26bdaad7b19f4b1d0556ce148d08609afeb4ef08c858d8c29b760205d5b376d57fba4c43eb98e80855e48466ca4b5876c18ba77100a512be8a626ad72c2207c9cb8ff8af1a14b44997755040e99072eaba7f937ebc3310130505563a7449f4cffa9e50a048157e5fbf008d3947105dcc46b9f098e15990366e4beb2bae863d94b2cb796e57f77321231f02603e2d718ee0fab05913a6897b14eca632cce4bba3c80de93de62f783089f4cc9e47730502eb17799aa1f8694c3f4c0e056d2cd437d5eee7bead814dbef7b495cfbef783a45f8fe188f18de6fc3e6863d7815913264c3a3d6e984466dd7e7def459f717be060a77571ac8f93f23a370d035db59f20054d5bdb5ac39fa7ba2c46c5f6689173c0caeb4bb551b18e88839f2440481069fd2e59544fbbb0ef5e2af7c719642b26d3ec7f86cb255e2a20d66c64b4fd6d6d245a4fc95cceeb4004ae13eb1ef25c55bddb3e33fe9221054fcd5ecbde194b946a929ce6d824cbb93dabbc03a90c7766cd2ee6799bb7f7a235b3be4025cf8fc9e3e002bf53b4e98fad1e32c66c529be04a8baab75a86d1fd0a6a56c82b490a38a27e9eeb958217f3d53"
